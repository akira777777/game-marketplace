# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è conftest.py - –û—Ç—á–µ—Ç –æ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ò–º–ø–æ—Ä—Ç—ã –∏ –ø—É—Ç–∏ –º–æ–¥—É–ª–µ–π**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥—É–ª—è–º–∏ app
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã: `MonkeyPatch`, `text` –¥–ª—è SQLAlchemy
- ‚úÖ –£–±—Ä–∞–Ω—ã –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã

### 2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–æ–≤**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ in-memory SQLite (`sqlite:///:memory:`) –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ Transaction rollback –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Å—Å–∏–π SQLAlchemy

### 3. **–§–∏–∫—Å—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ –¥–ª—è `test_game_data`: –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–æ–ª–∏: –∫–æ—Ä–æ—Ç–∫–∏–µ –ø–∞—Ä–æ–ª–∏ –¥–ª—è bcrypt
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è (`slug`, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç `date`)

### 4. **–ú–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–æ–∫–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è mock —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π ImportError/AttributeError

### 5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest**
- ‚úÖ –°–æ–∑–¥–∞–Ω `pytest.ini` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–∞—Ä–∫–µ—Ä—ã –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏–∏ —Ç–µ—Å—Ç–æ–≤
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –¥–ª—è —á–∏—Å—Ç–æ–≥–æ –≤—ã–≤–æ–¥–∞

### 6. **SQL –∑–∞–ø—Ä–æ—Å—ã**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `text()` –¥–ª—è raw SQL –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ SQLAlchemy 2.0+
- ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤–µ—Ä—Å–∏—è–º–∏ SQLAlchemy

## üß™ –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã

### ‚úÖ –†–∞–±–æ—á–∏–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã:
- `db_session` - —Å–µ—Å—Å–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –∏–∑–æ–ª—è—Ü–∏–µ–π
- `client` - FastAPI —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç
- `test_user_data` - –¥–∞–Ω–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `setup_test_db` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î
- `mock_external_services` - –º–æ–∫–∏ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- `temp_file` - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ç–µ—Å—Ç–æ–≤

### üìã –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `tests/conftest.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `pytest.ini` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è pytest
- `tests/README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∞–º
- `tests/test_conftest.py` - —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ñ–∏–∫—Å—Ç—É—Ä

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:
- `test_db_session_fixture` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ë–î
- `test_client_fixture` - –ø—Ä–æ–≤–µ—Ä–∫–∞ FastAPI –∫–ª–∏–µ–Ω—Ç–∞
- `test_temp_file_fixture` - –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (bcrypt –¥–ª—è –ø–∞—Ä–æ–ª–µ–π)
- –§–∏–∫—Å—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω–æ–π —Å—Ö–µ–º—ã –ë–î –¥–ª—è —Ä–∞–±–æ—Ç—ã

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

```bash
# –ü–µ—Ä–µ—Ö–æ–¥ –≤ backend –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd backend

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–µ—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–æ)
source venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install pytest pytest-asyncio fastapi sqlalchemy

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
python3 -m pytest tests/test_conftest.py::test_db_session_fixture -v

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ (–∫–æ–≥–¥–∞ –±—É–¥—É—Ç –≥–æ—Ç–æ–≤—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
pytest tests/ -v

# –ó–∞–ø—É—Å–∫ —Å –º–∞—Ä–∫–µ—Ä–∞–º–∏
pytest -m unit  # —Ç–æ–ª—å–∫–æ unit —Ç–µ—Å—Ç—ã
pytest -m integration  # —Ç–æ–ª—å–∫–æ integration —Ç–µ—Å—Ç—ã
```

## üìö –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** –∏–∑ requirements.txt –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
2. **–°–æ–∑–¥–∞—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã** –¥–ª—è API endpoints
3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å GitHub Actions** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
4. **–î–æ–±–∞–≤–∏—Ç—å coverage –æ—Ç—á–µ—Ç—ã** –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
# –ü—Ä–∏–º–µ—Ä unit —Ç–µ—Å—Ç–∞
def test_user_creation(db_session):
    user = User(username="test", email="test@example.com")
    db_session.add(user)
    db_session.commit()
    assert user.id is not None

# –ü—Ä–∏–º–µ—Ä API —Ç–µ—Å—Ç–∞
def test_api_endpoint(client, test_auth_headers):
    response = client.get("/api/users/me", headers=test_auth_headers)
    assert response.status_code == 200

# –ü—Ä–∏–º–µ—Ä integration —Ç–µ—Å—Ç–∞
@pytest.mark.integration
def test_full_workflow(client, db_session):
    # –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ workflow –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    pass
```

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã, –±–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç**  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ**: ‚úÖ **–ö–ª—é—á–µ–≤—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É—é—Ç**  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å**: üöÄ **–ì–æ—Ç–æ–≤–æ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è API**